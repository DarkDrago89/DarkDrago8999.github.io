<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kode Pos Indonesia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        button:hover:enabled {
            background-color: #45a049;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Cari Kode Pos</h1>
    
    <div class="form-group">
        <label for="province">Provinsi:</label>
        <select id="province">
            <option value="">Pilih Provinsi</option>
        </select>
    </div>

    <div class="form-group">
        <label for="district">Kabupaten/Kota:</label>
        <select id="district" disabled>
            <option value="">Pilih Kabupaten/Kota</option>
        </select>
    </div>

    <div class="form-group">
        <label for="subdistrict">Kecamatan:</label>
        <select id="subdistrict" disabled>
            <option value="">Pilih Kecamatan</option>
        </select>
    </div>

    <button id="searchBtn" disabled>Cari Kode Pos</button>

    <div id="result"></div>

    <script>
        let postalData = [];

        // Load data from local JSON file
        async function loadData() {
            try {
                const response = await fetch('./kodepos.json');
                postalData = await response.json();
                console.log('Isi postalData:', postalData); // Tambahkan ini
                populateProvinces();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('result').innerHTML = 'Gagal memuat data. Pastikan file kodepos.json ada di folder yang sama.';
            }
        }

        function populateProvinces() {
            const provinceSelect = document.getElementById('province');
            const uniqueProvinces = [...new Set(postalData.map(item => item.provinsi))];
            uniqueProvinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province;
                option.textContent = province;
                provinceSelect.appendChild(option);
            });
        }

        function loadDistricts() {
            const provinceSelect = document.getElementById('province');
            const districtSelect = document.getElementById('district');
            const subdistrictSelect = document.getElementById('subdistrict');
            const searchBtn = document.getElementById('searchBtn');

            districtSelect.innerHTML = '<option value="">Pilih Kabupaten/Kota</option>';
            subdistrictSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';
            districtSelect.disabled = true;
            subdistrictSelect.disabled = true;
            searchBtn.disabled = true;

            if (provinceSelect.value === '') return;

            const filteredDistricts = postalData.filter(item => 
                item.provinsi === provinceSelect.value
            );
            const uniqueDistricts = [...new Set(filteredDistricts.map(item => item.regency))];
            uniqueDistricts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
            districtSelect.disabled = false;
        }

        function loadSubdistricts() {
            const provinceSelect = document.getElementById('province');
            const districtSelect = document.getElementById('district');
            const subdistrictSelect = document.getElementById('subdistrict');
            const searchBtn = document.getElementById('searchBtn');

            subdistrictSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';
            subdistrictSelect.disabled = true;
            searchBtn.disabled = true;

            if (districtSelect.value === '') return;

            const filteredSubdistricts = postalData.filter(item => 
                item.provinsi === provinceSelect.value && 
                item.regency === districtSelect.value
            );
            const uniqueSubdistricts = [...new Set(filteredSubdistricts.map(item => item.district))];
            uniqueSubdistricts.forEach(subdistrict => {
                const option = document.createElement('option');
                option.value = subdistrict;
                option.textContent = subdistrict;
                subdistrictSelect.appendChild(option);
            });
            subdistrictSelect.disabled = false;
        }

        function enableSearchBtn() {
            const subdistrictSelect = document.getElementById('subdistrict');
            const searchBtn = document.getElementById('searchBtn');
            searchBtn.disabled = (subdistrictSelect.value === '');
        }

        function showPostalCode() {
            const provinceSelect = document.getElementById('province');
            const districtSelect = document.getElementById('district');
            const subdistrictSelect = document.getElementById('subdistrict');
            const resultElement = document.getElementById('result');

            if (subdistrictSelect.value === '') {
                resultElement.innerHTML = '';
                return;
            }

            const filteredResult = postalData.find(item => 
                item.provinsi === provinceSelect.value &&
                item.regency === districtSelect.value &&
                item.district === subdistrictSelect.value
            );

            if (filteredResult) {
                resultElement.innerHTML = `
                    <h3>Hasil Pencarian</h3>
                    <p><strong>Provinsi:</strong> ${filteredResult.provinsi}</p>
                    <p><strong>Kabupaten/Kota:</strong> ${filteredResult.regency}</p>
                    <p><strong>Kecamatan:</strong> ${filteredResult.district}</p>
                    <p><strong>Kode Pos:</strong> ${filteredResult.code}</p>
                `;
            } else {
                resultElement.innerHTML = 'Data tidak ditemukan';
            }
        }

        // Event listeners
        document.getElementById('province').addEventListener('change', loadDistricts);
        document.getElementById('district').addEventListener('change', loadSubdistricts);
        document.getElementById('subdistrict').addEventListener('change', enableSearchBtn);
        document.getElementById('searchBtn').addEventListener('click', showPostalCode);

        window.onload = loadData;
    </script>
</body>
</html>
